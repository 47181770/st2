#!/usr/bin/env python2.7

#
#   kandra adapter_container
#

import os
import sys
import logging
import logging.config
from oslo.config import cfg

DEVEL = True

if DEVEL:
    '''
        Explicitly add the module path to the module search path to support development
        environment without needing to go through an install procedure.
    '''
    python_lib_dir = os.path.abspath(os.path.dirname(sys.argv[0]) + '/..')
    sys.path.append(python_lib_dir)
    #print sys.path

from st2reactor import config
from st2reactor.adapter import container
from st2reactor.adapter.adapters import FixedRunAdapter

LOG = logging.getLogger('st2reactor.bin.adapter_container')


def setup():
    config.parse_args()
    print cfg.CONF.reactor_logging.config_file
    logging.config.fileConfig(cfg.CONF.reactor_logging.config_file,
                              defaults=None,
                              disable_existing_loggers=False)


def main():
    setup()

    LOG.info('AdapterContainer process[{}] started.'.format(os.getpid()))
    adapter_container = container.AdapterContainer([FixedRunAdapter,
                                                    FixedRunAdapter])
    exit_code = adapter_container.main()
    LOG.info('AdapterContainer process[{}] exit with code {}.'.format(
        os.getpid(), exit_code))

    sys.exit(exit_code)

if __name__ == '__main__':
    main()
