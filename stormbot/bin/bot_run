#!/bin/bash

BOTNAME="stormbot"
BOTDIR="/opt/stackstorm/${BOTNAME}"

function getpid(){
  PID=`ps ax | grep hubot | grep -v grep | awk '{print $1}'`
}

function startbot(){
  getpid
  if [[ -z $PID ]]; then
    pushd ${BOTDIR} > /dev/null
    bin/hubot-hipchat &> /tmp/${BOTNAME}.log &
    popd > /dev/null
    getpid
    echo "${BOTNAME} is running PID:${PID}"
  else
    echo "${BOTNAME} is already running PID:${PID}"
  fi
}

function stopbot(){
  getpid
  if [[ -z $PID ]]; then
    echo "${BOTNAME} is not running"
  else
    echo "killing ${BOTNAME} PID:${PID}"
    kill ${PID}
  fi
}

case ${1} in
start)
  startbot
  ;;
stop)
  stopbot
  ;;
restart)
  stopbot
  startbot
  ;;
status)
  getpid
  echo "${BOTNAME} PID:${PID}"
  ;;
*)
  echo "valid commands: start|stop|restart|status"
  exit 1
  ;;
esac
