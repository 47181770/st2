#!/bin/bash

FROM="stanley@st2stage.stackstorm.net"
SENDMAIL=`which sendmail`
MAIL="$SENDMAIL -t"
FOOTER="This message was generated by Stanley Action `basename $0` running on `hostname`"
TO=$1
shift
SUBJECT=$1
shift
SEND_EMPTY_BODY=$1
shift
BODY="$@"

if [[ -z "${BODY// }" && $SEND_EMPTY_BODY == 'True' ]] || [[ -n $BODY ]]; then
  ${MAIL} <<EOF
TO: ${TO}
FROM: ${FROM}
SUBJECT: ${SUBJECT}
Content-Type: text/html

${BODY}
<br><br>
${FOOTER}

EOF

fi

if [ $? -ne 0 ]; then
  echo "Failed to send mail to ${TO}"
  exit 2
else
  echo "Successfully sent mail to ${TO}"
  exit 0
fi
